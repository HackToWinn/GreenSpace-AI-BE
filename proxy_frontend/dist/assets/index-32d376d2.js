import{AuthClient as g}from"https://esm.sh/@dfinity/auth-client@2.4.1";import{DelegationChain as m,Ed25519KeyIdentity as y}from"https://esm.sh/@dfinity/identity@2.4.1";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const s of t.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function r(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function o(e){if(e.ep)return;e.ep=!0;const t=r(e);fetch(e.href,t)}})();async function p(){return await y.generate()}function a(i){return new URLSearchParams(window.location.search).get(i)}async function h(){const i=a("sessionPublicKey"),n=a("callback");if(!i||!n){document.getElementById("status").innerText="Missing sessionPublicKey or callback in URL.";return}const r=Uint8Array.from(atob(i),t=>t.charCodeAt(0)),o=await p(),e=await g.create({identity:o});await e.login({identityProvider:"https://identity.ic0.app",onSuccess:async()=>{var c;e.getIdentity();const t=(c=e.getDelegation())==null?void 0:c.delegations[0],l=BigInt(Date.now())*1000000n+30n*60n*1000000000n,d=await o.createSignedDelegation({publicKey:r},l),u=m.fromDelegations([t,d],r),f=btoa(JSON.stringify(u.toJSON()));window.location.href=`${n}#delegation=${encodeURIComponent(f)}`},maxTimeToLive:BigInt(30*60*1e9)})}document.getElementById("loginBtn").addEventListener("click",h);
